(function(a){var b=function(f,j){var f=a(f),u=this,C=false,D=false,k=0,A=0,B=new Object(),z=a(z),v=0,s=a("body");var q={delay:18,lensWidth:100,lensHeight:100,lensBackgroundColor:"#fff",lensOpacity:0.5,previewWidth:200,previewHeight:200,lensBorder:1,lensBorderColor:"#000",showLens:true,loaderImage:"loader.gif",zoomAnimation:false,zoomAnimationInterval:80,annotationsBorderColor:"#000",annotationBackgroundColor:"#fff",zoomPreviewWindowEffect:"default",annotationOpacity:0.3,annotations:new Array()};var t=f.find("img.tiksluszoom"),m=f.find("img.tiksluszoom").attr("data-big-image"),J;j=a.extend(q,j);var H=function(){f.append("<div class='zoom-preview-wrapper'><div class='zoom-preview'></div><div class='annotation'></div></div>")};this.getCoord=function(){B.left=t.position().left;B.top=t.position().top;B.right=t.width();B.bottom=t.height();return B};var n=function(){f.append("<div class='lens'></div>");J=f.find(".lens");if(j.showLens==true){J.css({width:j.lensWidth,height:j.lensHeight,opacity:j.lensOpacity,backgroundColor:j.lensBackgroundColor,border:j.lensBorder,borderTopStyle:"solid",borderLeftStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderTopColor:j.lensBordercolor,borderLeftColor:j.lensBordercolor,borderBottomColor:j.lensBordercolor})}else{J.find(".lens").css({width:j.lensWidth,height:j.lensHeight,cursor:"crosshair"})}return J};var G=function(){J.css({visibility:"hidden"})};var r=function(){J.css({visibility:"visible"})};var h=function(){var N=u.getCoord();for(var M=0;M<j.annotations.length;M++){var L=0,K=0;L=N.left+j.annotations[M].x;K=N.top+j.annotations[M].y;f.append("<div  style='border:1px solid ;border-color:"+j.annotationsBorderColor+";background-color:"+j.annotationBackgroundColor+";position:absolute;left:"+L+"px;top:"+K+"px;width:"+j.lensWidth+"px;height:"+j.lensHeight+"px;border:1px solid #eee;z-index:0;opacity:"+j.annotationOpacity+"'></div>")}};var y=function(L,P){if(j.annotations.length>0){for(var N=0;N<j.annotations.length;N++){var M=0,K=0;var O=u.getCoord();M=O.left+j.annotations[N].x;K=O.top+j.annotations[N].y;if(L>=M&&L<=M+j.lensWidth&&P>=K&&P<=K+j.lensHeight){f.find(".zoom-preview-wrapper .annotation").show().html(j.annotations[N].annotation)}}}};var g=function(){if(v==0){return true}else{return false}};var l=function(){f.find(".zoom-preview-wrapper").hide();v=0};var F=function(){var M=t.position().left+t.width()+20;var L=t.position().top;var K=t.height()+L;if(K>a(window).height()+a(window).scrollTop()||M>a(window).width()+a(window).scrollLeft()){L=L-t.height();M=t.position().left}f.find(".zoom-preview-wrapper").css({left:M+"px",top:L+"px"});switch(j.zoomPreviewWindowEffect){case"fade":f.find(".zoom-preview-wrapper").fadeIn("slow");break;case"default":f.find(".zoom-preview-wrapper").show();break;default:f.find(".zoom-preview-wrapper").show()}v=1};var i=function(){f.find(".zoom-preview-wrapper .annotation").html("").hide()};h();H();n();this.loadBigImage=function(O){var L=new Image();var N=u.getCoord();L.src=O||m;m=L.src;var Q=f.find(".zoom-preview").width()/2;var P=f.find(".zoom-preview").height()/2;var M=N.left+N.right/2;var K=N.top+N.bottom/2;if(f.find(".zoom-loading").length<=0){f.append("<div class='zoom-loading'></div>");f.find(".zoom-loading").append("<img src='"+j.loaderImage+"' border='0'>")}t.addClass("fade");f.find(".zoom-loading").css({position:"absolute",left:M+"px",top:K+"px",zIndex:1000});a("body").css("cursor","none");G();t.css({opacity:0.3});L.onload=function(){k=L.width;A=L.height;f.find(".zoom-preview").css({"background-image":"url('"+L.src+"')",visibility:"visible"});f.find(".zoom-loading").remove();F();t.removeClass("fade");a("body").css("cursor","haircross");C=true;r();t.css({opacity:1})}};var x=function(M,L){var K=u.getCoord();ctop=L-j.lensHeight/2-K.top;cleft=M-j.lensWidth/2-K.left;J.css({top:L-j.lensHeight/2+"px",left:M-j.lensWidth/2+"px",visibility:"visible",width:j.lensWidth+"px",height:j.lensHeight+"px"});D=true};var E=function(L,K){ctop=K-j.lensHeight/2;cleft=L-j.lensWidth/2;J.css({top:K-j.lensHeight/2+"px",left:L-j.lensWidth/2+"px",width:j.lensWidth+"px",height:j.lensHeight+"px"})};var e=function(){J.css({top:0,left:0,widht:0,height:0,visibility:"hidden"});s.css({cursor:"default"})};var w=function(){if(J.is(":visible")){return false}else{return true}};var d=function(M,K){var L=u.getCoord();if(C==true&&D==true){var N=0;var P=0;P=parseFloat(k/t.width()).toFixed(1);N=parseFloat(A/t.height()).toFixed(1);P=parseFloat(k/t.width()).toFixed(1);N=parseFloat(A/t.height()).toFixed(1);var R=K-j.lensHeight/2-L.top;var O=M-j.lensWidth/2-L.left;if(j.zoomAnimation==true){var S=-(O*P);var Q=-(R*N);f.find(".zoom-preview").animate({"background-position-x":S+"px","background-position-y":Q+"px"},j.zoomAnimationInterval)}else{f.find(".zoom-preview").css({backgroundPosition:-(O*P)+"px "+(-(R*N)+"px")})}f.find(".zoom-preview").css("width",j.lensWidth*P+"px");f.find(".zoom-preview").css("height",j.lensHeight*N+"px");f.find(".zoom-preview-wrapper").css("width",j.lensWidth*P+"px");f.find(".zoom-preview-wrapper").css("height",j.lensHeight*N+"px")}};var o=function(){var L;var M;L=screen.width;M=a(z).height();var K="<div id='tiksluszoom_overlay'></div>";if(a("#tiksluszoom_overlay").length==0){s.append(K)}a("#tiksluszoom_overlay").css({left:0,top:0,width:L+"px",height:M+"px",position:"absolute"}).fadeIn("fast")};var c=function(L,K){var O=(a(window).width()-L)/2+a(window).scrollLeft();var N=(a(window).height()-K)/2+a(window).scrollTop();a("#tiksluszoom_lightbox").remove();var M="<div id='tiksluszoom_lightbox' style='width:"+L+"px;left:"+O+"px;top:"+N+"px;height:"+K+"px;position:absolute'><div class='tiksluszoom_lightbox_inner'><ul class='operations'><li><a href='#' class='tiksluszoom_lightbox_close'>X</a></li></ul></div></div>";s.append(M);a("#tiksluszoom_lightbox").fadeIn("slow")};this.destroyLightbox=function(){a("#tiksluszoom_lightbox").fadeOut("slow").find("img").remove()};this.destroyOverlay=function(){a("#tiksluszoom_overlay").fadeOut("fast").css({width:0,height:0})};var p=function(){var K=a(window).width();var N=a(window).height();var L=0;var M=0;L=k;M=A;if(k>=K){L=K*90/100}if(A>=N){M=N*90/100}f.find("div").hide();c(L,M);a(".tiksluszoom_lightbox_inner").find(".preview").remove();a(".tiksluszoom_lightbox_inner").prepend("<img  class='preview' src='"+m+"' style='max-width:100%;max-height:100%;'/>").fadeIn("slow");s.css({cursor:"default"});a("a.tiksluszoom_lightbox_close").click(function(O){O.preventDefault();u.destroyLightbox();u.destroyOverlay()});a("#tiksluszoom_overlay").click(function(O){O.preventDefault();u.destroyLightbox();u.destroyOverlay()});a(".preview").click(function(O){u.destroyLightbox();u.destroyOverlay()})};var I=function(){if(a("#tiksluszoom_lightbox").is(":visible")){var L=a("#tiksluszoom_lightbox").height();var K=a("#tiksluszoom_lightbox").width();a("#tiksluszoom_lightbox").animate({top:(a(window).height()-L)/2+a(window).scrollTop(),left:(a(window).width()-K)/2+a(window).scrollLeft()},5)}};t.mouseenter(function(K){if(D==false){x(K.pageX,K.pageY)}if(C==false){u.loadBigImage()}if(!g()){F()}if(w()==true){f.find("div").show()}});t.mousemove(function(K){if(D){d(K.pageX,K.pageY);E(K.pageX,K.pageY)}});J.mousemove(function(K){if(K.pageX>=t.position().left&&K.pageX<=(t.width()+t.position().left)&&K.pageY>=t.position().top&&(K.pageY<=t.height()+t.position().top)&&D==true){i();if(w()==true){x();r()}if(g()){F()}E(K.pageX,K.pageY);d(K.pageX,K.pageY);y(K.pageX,K.pageY)}else{e();s.css({cursor:"default"});D=false;l()}});J.click(function(K){o();p();K.preventDefault()});z.scroll(function(){if(a("#tiksluszoom_lightbox").is(":visible")){I()}})};a.fn.tiksluszoom=function(c){return this.each(function(){var d=a(this);if(d.data("tiksluszoom")){return}var e=new b(this,c);d.data("tiksluszoom",e)})}})(jQuery);